Combinatoire du jeu
===================

Dans un premier temps, intéressons nous au combinatoire du jeu "Bataille navale". Est-il possible possible de déterminer le nombre de grilles possible ?

## Approche naïve

Une borne supérieur naïve serait $A^{17}_{100} \approx 2 \times 10^{33}$.
En effet nous avons un échiquier de taille 10 x 10 soit 100 cases et nous devons placer en tout $5 + 4 + 3 + 3 + 2 = 17$,
En ignorant toutes les règles, le nombre maximal de plateau possible est donc toutes les manières différentes de poser les 17 cases parmis les 100 disponibles,
soit donc un arrangement de 17 parmis 100.

Cependant, ce nombre ne prends pas en compte le fait que les cases d'un même bateau doivent être adjacente.
Il est possible aussi de calculer une autre borne supérieur un peu plus précise on comptabilisant manuellement le nombre de façon possible de poser un bateau de taille n dans un 10x10. Voici les résultat obtenu :


Bateau              | Taille    | nb
--------------------|-----------|----
Porte avion         | 5         | 120
Croiseur            | 4         | 140
Contre-torpilleurs  | 3         | 160
Sous-marin          | 3         | 160
torpilleur          | 2         | 180

Ce qui nous donne alors comme nombre de configuration maximal théorique : $7.74 \times 10^{10}$.
Cette borne cependant inclue les plateaux où les bateaux se supperpose.

Vérifions ces valeurs avec notre implémentation du jeu. Les fonctions pour cela se trouvent dans `src/Game/EngineStats.py`.

La fonction `EngineStats.nb_placer(type)` fait exactement ce que nous voulons, elle parcours chaque case du plateau et vérifie avec `Engine.peut_placer(type)` si le bateau donnée en paramètre peut être placé à la case, si oui elle ajoute 1. 
Nous obtenons bien les résultats théorique avec cette fonction.

La fonction `EngineStats.nb_placerL(types)` utilise la fonction précédente pour calculer les plateaux possibles avec la méthode utilisé précédemment (donc elle inclue les plateaux où les bateaux se superpose). Et on retrouve avec le résultat théorique obtenue avant.
La fonction est assez simple, vous faisons juste la mutuplication de chacun des résultats.

```py
def nb_placerL(types: list[int])->int:
    nb = 1
    for type in types:
        nb *= EngineStats.nb_placer(type)
    return nb
```

Mais n'est-il pas possible d'obtenir une approximation encore plus précise du nombre exacte de plateau possible ? Essayons la méthode brute.

## Brute force

La fonction naïve et brute `EngineStats.nb_placerL_brute(types)` peut en théorie nous donner le nombre de plateaux exacte possible. Elle procèdes ainsi :

- Tout les bateaux sont posés à la première position possible en faisant bien attention de pas les superposer.

- Une fois tout les bateaux posés, elle incrémente le compteur de position possible et place le dernier bateau à toutes ses positions en incrémentant à chaque fois.

- Une fois que le dernier bateau a écouté toutes ses positions, on place l'avant dernier bateau à sa prochaine position viable.

- Et ainsi de suite jusqu'à ce que tout les bateaux aient écoulé toutes leur positions possible.

Voici les valeurs qu'on a pu obtenir :

Bateaux  | `nb_placerL_brute()`
---------|---
1        | 120
1, 2     | 14400
1, 2, 3  | 1850736

Cette fonction marche très bien pour des petites listes de bateaux ou pour des petites grilles, mais pour notre cas le temps d'excecution est énorme, même en optimisant avec les symètries cela prendrais toujours trop de temps, notre fonction se rapproche d'une complexité $O\left( (3n)^m \right)$ avec n la taille de la dimension du plateau (supposé carré) et m le nombre de bateau.

Python n'est pas le langage pour ce genre de calcul intensif, on sait que notre résultat doit être aux alentours de $10^{10}$. Le bout de code simplite suivant prend déjà trop longtemps à s'excécuter :
```py
i = 0
while i < 1e10:
    i+=1
```
N'y a-t-il pas une autre méthode qui nécessite pas de faire tant de calcul ?

## Approche Aléatoire

Étudions dans un premier temps le le lien entre le nombre de grille et la probabilité d'en tirer une aléatoirement.

La probabilité uniforme sur un univers fini $\Omega$ est définie par la fonction de masse :
$$p(\omega) = \frac{1}{card(\Omega)} = \frac{1}{g}$$
Avec $\omega$ l'événement élémentaire "tirer une grille donnée", $\Omega$ toutes les grilles possibles et $g$ le nimbre de grilles.

Bien évidement on suppose ici que toutes les grilles sont équiprobable.

Nous pouvons donc explorer la formule suivante pour déduire d'une approximation du nombre totale de grille :
$$g=\frac{1}{p(\omega)}$$

Notre fonction `EngineStats.nb_alea(grille)` générer de manière aléatoire des plateaux jusqu'à tomber sur celui donné en paramètre et retroune le nombre d'itération que ce la a fallu.
Malheuresement cette fonction prends effectivement trop de temps à s'excécuter pour les 5 bateaux selon notre implémentation.